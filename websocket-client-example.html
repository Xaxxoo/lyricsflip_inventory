<!DOCTYPE html>
<html>
<head>
    <title>Inventory WebSocket Client</title>
    <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>
<body>
    <h1>Real-time Inventory Updates</h1>
    
    <div id="status">Disconnected</div>
    
    <div>
        <h3>Subscribe to Stock Updates</h3>
        <input type="text" id="skuInput" placeholder="Enter SKU (optional)">
        <button onclick="subscribeToStock()">Subscribe</button>
        <button onclick="unsubscribeFromStock()">Unsubscribe</button>
    </div>
    
    <div>
        <h3>Live Updates</h3>
        <div id="updates"></div>
    </div>

    <script>
        const socket = io('http://localhost:3000/inventory');
        const statusDiv = document.getElementById('status');
        const updatesDiv = document.getElementById('updates');

        socket.on('connect', () => {
            statusDiv.textContent = 'Connected';
            statusDiv.style.color = 'green';
        });

        socket.on('disconnect', () => {
            statusDiv.textContent = 'Disconnected';
            statusDiv.style.color = 'red';
        });

        socket.on('connected', (data) => {
            addUpdate('System', data.message);
        });

        socket.on('stock-updated', (data) => {
            addUpdate('Stock Update', `SKU: ${data.sku}, Location: ${data.locationId}, Quantity: ${data.quantity} (Change: ${data.change})`);
        });

        socket.on('low-stock-alert', (data) => {
            addUpdate('Low Stock Alert', `SKU: ${data.sku}, Location: ${data.locationId}, Current: ${data.currentQuantity}, Threshold: ${data.threshold}`, 'red');
        });

        socket.on('inventory-movement', (data) => {
            addUpdate('Movement', `SKU: ${data.sku}, From: ${data.fromLocation}, To: ${data.toLocation}, Quantity: ${data.quantity}`);
        });

        socket.on('dashboard-update', (data) => {
            addUpdate('Dashboard', `Total Items: ${data.totalItems}, Low Stock: ${data.lowStockItems}, Total Value: $${data.totalValue}`);
        });

        function subscribeToStock() {
            const sku = document.getElementById('skuInput').value;
            socket.emit('subscribe-to-stock', { sku: sku || undefined });
        }

        function unsubscribeFromStock() {
            const sku = document.getElementById('skuInput').value;
            socket.emit('unsubscribe-from-stock', { sku: sku || undefined });
        }

        function addUpdate(type, message, color = 'black') {
            const div = document.createElement('div');
            div.style.color = color;
            div.innerHTML = `<strong>[${new Date().toLocaleTimeString()}] ${type}:</strong> ${message}`;
            updatesDiv.insertBefore(div, updatesDiv.firstChild);
            
            // Keep only last 50 updates
            while (updatesDiv.children.length > 50) {
                updatesDiv.removeChild(updatesDiv.lastChild);
            }
        }
    </script>
</body>
</html>